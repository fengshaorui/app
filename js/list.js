$(function(){var t=function(){var i=0;function a(){var t=window.location.search,l=decodeURI(t.split("=")[1]);$(".item a").html(l),$(".list-item ul").data("flag")&&$.ajax({type:"get",url:"api/list.php",data:{type:l,page:i},dataType:"json",success:function(t){e(t),o(),i++,n(0),myScroll.refresh()},error:function(t){$(".loadtip p").html("无更多商品..."),$(".list-item ul").data("flag","false")}})}function e(t){$(".list-item ul .loadtip").remove();var l=$("#listgoods").html(),i=ejs.render(l,{list:t});$(".list-item ul").append(i);$(".list-item ul").append("<li class='loadtip'><p>上拉加载更多。。。</p></li>")}function o(){$(".list-item ul li").click(function(){var t=$(this).data("id");window.location.href="detail.html?id="+t})}function n(t){myScroll=new IScroll("#wrapper",{probeType:2});var l=!1;myScroll.on("scroll",function(){this.y<this.maxScrollY-10&&!l?(l=!0,$(".loadtip p").html("松手开始刷新...")):this.y>this.maxScrollY-10&&l&&(l=!1,$("loadtip p").html("下拉刷新..."))}),myScroll.on("scrollEnd",function(){l&&($(".loadtip p").html("正在加载..."),0==t?a():1==t&&s(l),$(".list-item ul").data("flag")?$(".loadtip p").html("下拉刷新..."):$(".loadtip p").html("无更多商品..."))})}var r=0;function s(t){if($(".list-item ul").data("flag")){var l=window.location.search,i=decodeURI(l.split("=")[1]);$(".item a").html(i),$.ajax({type:"get",url:"api/list2.php",data:{type:i,page:r,order:Number(t)},dataType:"json",success:function(t){e(t),o(),r++,n(1),myScroll.refresh(),console.log(r)},error:function(t){$(".loadtip p").html("无更多商品..."),$(".list-item ul").data("flag","false")}})}}return{init:a,selectFun:function(){var l=!0;$(".detailTab .price").click(function(){if($(".list-item ul").html(""),$(".detailTab .price").children("img").remove(),l){var t="<img src='imgs/sort/des.png'>";$(".detailTab .price").append(t),l=!1}else t="<img src='imgs/sort/res.png'>",$(".detailTab .price").append(t),l=!0;s(l)})}}}();t.init(),t.selectFun()});